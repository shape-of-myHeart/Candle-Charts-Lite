"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Chart=function(){var t=function(t){return t},e={globalStyle:{backgroundColor:"rgb(245, 250, 254)",fontFamily:"맑은고딕",labelColor:"#5d5d5d",yLabelShow:!0,yLabelAlign:"right",yLabelWidth:100,yAxisShow:!0,yAxisColor:"#999",xLabelShow:!0,xLabelAlign:"bottom",xLabelHeight:30,xAxisShow:!0,xAxisColor:"#999",xSplitAxisColor:"rgb(210, 215, 219)",xSplitAxisDotted:!1,ySplitAxisColor:"rgb(210, 215, 219)",ySplitAxisDotted:[1,2],tooltipTextColor:"#333",tooltipBackgroundColor:"transparent",tooltipXAlign:"left",tooltipYAlign:"top",tooltipMinWidth:100,tooltipFontSize:14,tooltipXMargin:5,tooltipYMargin:5,tooltipXPadding:20,tooltipYPadding:5,tooltipCandleThick:5,tooltipLetterSpace:10,focusXAxisColor:"rgba(105, 100, 104, 0.1)",focusXBackgroundColor:"#555",focusXLabelColor:"#fff",focusXAxisExtend:!0,focusYAxisColor:"#888",focusYBackgroundColor:"#555",focusYLabelColor:"#fff",minSpan:8,lastIndexYLabelColor:"#333"},layerType:"candle",layerStyle:{candle:{incrementItemColor:"rgb(252,4,4)",decrementItemColor:"rgb(0,168,0)",decrementItemFill:!0,incrementItemFill:!0,renderMinMaxInViewport:!1,renderLastIndex:!0},line:{itemColor:"#000000",horizon:null,renderMinMaxInViewport:!1,renderLastIndex:!0},stick:{itemColor:"#000000",itemFill:!0,linear:!1,baseLine:null,renderMinMaxInViewport:!1,renderLastIndex:!0}},grid:{top:0,right:0,bottom:0,left:0},padding:{top:30,right:0,bottom:30,left:0},dateFormatter:"MM-dd HH:mm"},o={white:{globalStyle:{},layerStyle:{candle:{},line:{}}},dark:{globalStyle:{backgroundColor:"#151515",labelColor:"#aaa",xSplitAxisColor:"#333",ySplitAxisColor:"#333",tooltipTextColor:"#fff",focusXAxisColor:"rgba(0, 175, 255, 0.2)",focusXBackgroundColor:"rgb(10,98,138)",focusYBackgroundColor:"#333",tooltipBackgroundColor:"rgba(0,0,0,0.25)",lastIndexYLabelColor:"#fff"},layerStyle:{candle:{incrementItemColor:"#14b143",decrementItemColor:"#ef232a"},line:{itemColor:"#999"},stick:{itemColor:"#999"}}}},n={candle:function(e){var o=e.title,n=e.data,i=e.formatter,r=void 0===i?t:i;return null===n||void 0===n?null:[(o.open||"Open")+" "+r(n.open),(o.close||"Close")+" "+r(n.close),(o.low||"Low")+" "+r(n.low),(o.high||"High")+" "+r(n.high)]},line:function(e){var o=e.title,n=e.data,i=e.formatter,r=void 0===i?t:i;return null===n||void 0===n?null:o+" "+r(n)},stick:function(e){var o=e.title,n=e.data,i=e.formatter,r=void 0===i?t:i;return null===n||void 0===n?null:o+" "+r(n)}},i={candle:function(t){return t.low},line:function(t){return t},stick:function(t){return t}},r={candle:function(t){return t.high},line:function(t){return t},stick:function(t){return t}},l=function(t,e){return"candle"===t.type?t.data[e].close>t.data[e].open?t.style.incrementItemColor:t.style.decrementItemColor:"line"===t.type?t.style.itemColor:"stick"===t.type?"function"==typeof t.style.itemColor?t.style.itemColor(e):t.style.itemColor:void 0},a=function(t,e,o,n,i){return(t-e)/(o-e)*(i-n)+n},s=Math.floor,c=function(t,e){("object"!==("undefined"==typeof t?"undefined":_typeof(t))||null===t)&&(t={});for(var o in e)void 0===t[o]&&(t[o]=e[o]);return t},f=function(t,e){var o=void 0;return e.replace(/(yyyy|yy|MM|dd|hh|mm|ss)/gi,function(e){switch(e){case"yyyy":return t.getFullYear();case"yy":return u(t.getFullYear()%1e3,2);case"MM":return u(t.getMonth()+1,2);case"dd":return u(t.getDate(),2);case"HH":return u(t.getHours(),2);case"hh":return u((o=t.getHours()%12)?o:12,2);case"mm":return u(t.getMinutes(),2);case"ss":return u(t.getSeconds(),2);default:return e}})},u=function(t,e){if("number"==typeof t&&(t=t.toString()),"string"==typeof t){for(var o="",n=0;n++<e-t.length;)o+="0";return o+t}},d=[],h={},g=function m(t){var u=this;_classCallCheck(this,m);var g=document.getElementById(t);if(null!==g){for(var v=void 0;-1!==d.indexOf(v=Math.random()+Math.random()+Math.random()););var p=h[v]={},y=void 0,x={};g.style.position="relative";var b=[],C=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=document.createElement("canvas"),o=e.getContext("2d");return e.style.position="absolute",e.style.top=0,e.style.left=0,e.style.zIndex=t,e.width=g.clientWidth,e.height=g.clientHeight,g.appendChild(e),o.translate(.5,.5),b.push(e),{canvas:e,context:o}},S={},T=[],k=[],w=[],A=c(null,e.grid),L=c(null,e.padding),M=c(null,e.globalStyle),P=e.dateFormatter,I=void 0,Y=void 0,H=void 0,X=C().context,F=C().context,W=C().context,B=C(1).context,R=C(2).context,V=function(t,o){var n=o.type,i=o.data,r=o.show,l=o.style;if("string"==typeof t&&void 0===S[t]){var a=C();a.show=void 0!==r?r:!0,a.type=n||e.layerType,a.data=i||[],a.style=c(l,x[a.type]),S[t]=a,rt()}},$=function(t,e){var o=e.type,n=e.show,i=e.data,r=e.style,l=S[t];l.show=void 0!==n?n:l.show;var a=void 0!==o&&o!==l.type?x[o]:l.style;l.type=o||l.type,l.data=i||l.data,l.style=c(r,a),rt()},D=function(t,e){var o=[];for(var n in S){var i=t(S[n],n);e?o[e(n)]=i:o.push(i)}return o},E=function(t,e){if(!(0>t||0>e||T[0]===t&&T[1]===e)){var o=Math.max(t,e),n=Math.min(t,e);T[0]=n,T[1]=o,rt()}},z=function(t,e){if(!(0>t||0>e||T[0]===t&&T[1]===e)){var o=Math.max(t,e),n=Math.min(t,e);if(Yt()!==!0){var i=h[u.$rootConnect].minSpan();return i>o-n&&(n=o-i),void h[u.$rootConnect].dispatchSetViewport(n,o)}o-n<M.minSpan&&(n=o-M.minSpan),h[v].dispatchSetViewport(n,o),E(n,o)}},N=function(){return[T[0],T[1]]},_=function(t){for(var e=0,o=t.length;o>e;e++)"string"==typeof t[e]&&(t[e]=new Date(t[e]));w=k=t,p.setTimeline(),Yt()===!0&&p.dispatchSetTimeline()},j=function(t){P=t,Z()},O=function(t){L=c(t,L);for(var e in S){var o=S[e];it(o)}},U=function(t){M=c(t,M),J(),kt(),rt()},q=s,G=function(t){return q=t},J=function(){var t=M.xLabelShow===!1?0:1,e=M.yLabelShow===!1?0:1;A.top="top"===M.xLabelAlign?M.xLabelHeight*t:0,A.bottom="bottom"===M.xLabelAlign?M.xLabelHeight*t:0,A.left="left"===M.yLabelAlign?M.yLabelWidth*e:0,A.right="right"===M.yLabelAlign?M.yLabelWidth*e:0},K=function(){return{tWidth:g.clientWidth-A.right-A.left,tHeight:g.clientHeight-A.bottom-A.top}},Q=function(){for(var t=D(function(t){var e=t.data,o=t.type,n=t.show,l=t.style;if(n===!1)return{min:1/0,max:-(1/0)};var a=i[o],s=r[o],c=1/0,f=-(1/0);if("line"===o&&l.horizon===!0)return{min:e[0],max:e[0]};for(var u=T[0],d=T[1];d>u;u++)if(null!==e[u]&&void 0!==e[u]){var h=a(e[u]),g=s(e[u]);c>h&&(c=h),g>f&&(f=g)}return t.minInViewport=c,t.maxInViewport=f,{min:c,max:f}}),e=1/0,o=-(1/0),n=0;n<t.length;n++)t[n].min<e&&(e=t[n].min),t[n].max>o&&(o=t[n].max);I=e,Y=o},Z=function(){var t=M,e=t.xLabelHeight,o=t.xLabelAlign,n=t.xLabelShow,i=t.xAxisShow;if(0!==w.length){var r=g.clientWidth,l=g.clientHeight,a=K(),c=a.tWidth,u=a.tHeight,d=c/(T[1]-T[0]);F.save(),F.clearRect(-10,-10,r+10,l+10),F.translate(A.left,0),F.textBaseline="middle",F.textAlign="left"===M.yLabelAlign?"right":"left",F.font="12px "+M.fontFamily;var h=u,m="top"===o?e/2:l-e/2,v="bottom"===o?h:A.top;n!==!1&&(F.strokeStyle=M.xAxisColor,F.beginPath(),F.moveTo(0,v),F.lineTo(c,v),F.closePath(),F.stroke()),F.fillStyle=M.labelColor;for(var p=T[0],y=T[1],x=s((T[1]-T[0])/5);y>p;p++){if(T[0]-y===-1||(y-p)%x===0){var b=s(.5*d);i!==!1&&(Array.isArray(M.xSplitAxisDotted)&&F.setLineDash(M.xSplitAxisDotted),F.strokeStyle=M.xSplitAxisColor,F.beginPath(),F.moveTo(b,A.top),F.lineTo(b,h+A.top),F.closePath(),F.stroke()),n!==!1&&(F.strokeStyle=M.xAxisColor,F.beginPath(),F.moveTo(b,v+("bottom"===o?5:-5)),F.lineTo(b,v),F.closePath(),F.stroke(),F.fillText(f(w[p],P),s(b),s(m)))}F.translate(d,0)}F.restore()}},tt=function(){var t=M,e=t.yLabelWidth,o=t.yLabelAlign,n=t.yLabelShow,i=t.yAxisShow,r=g.clientWidth,l=g.clientHeight,c=K(),f=c.tWidth,u=c.tHeight;X.save(),X.clearRect(-10,-10,r+10,l+10),X.translate(0,-1),X.textBaseline="middle",X.textAlign="left"===o?"right":"left",X.font="12px "+M.fontFamily;var d=s("left"===o?e:r-e);X.strokeStyle=M.yAxisColor,X.fillStyle=M.labelColor,n!==!1&&(X.beginPath(),X.moveTo(d,A.top),X.lineTo(d,A.top+u),X.closePath(),X.stroke());for(var h=2,m=(Y-I)/h,v=1;m>10*v;)v*=10;m-=m%v,m=s(m);for(var p=s(I-I%m),y=-10;h+10>=y;y++){var x=p+m*y,b=a(x,Y,I,A.top+L.top,A.top+u-L.bottom);if(!(b>A.top+u)){if(b<A.top)break;n!==!1&&(X.fillText(q(x),d+("right"===o?10:-10),b),X.strokeStyle=M.labelColor,X.beginPath(),X.moveTo(d,b),X.lineTo(d+("right"===o?5:-5),b),X.closePath(),X.stroke()),i!==!1&&(X.save(),Array.isArray(M.ySplitAxisDotted)&&X.setLineDash(M.ySplitAxisDotted),X.strokeStyle=M.ySplitAxisColor,X.beginPath(),X.moveTo(A.left,b),X.lineTo(f+A.left-1,b),X.closePath(),X.stroke(),X.restore())}}X.restore()},et={candle:function(t){return function(e){return a(e,Y,I,A.top+L.top,A.top+t-L.bottom)}},line:function(t){return function(e){return a(e,Y,I,A.top+L.top,A.top+t-L.bottom)}},stick:function(t){return function(e){return a(e,Y,I,A.top+L.top,A.top+t-L.bottom)}}},ot=function(t,e,o,n,l,a,c,f,u){var d=r[e](u),h=i[e](u),g=n(d),m=n(h);t.strokeStyle=t.fillStyle=M.labelColor,t.textBaseline="middle",t.font="13px "+M.fontFamily;var v=s(.5*o),p=q(d),y=q(h),x=-1,b=(f-T[0])*o+x*Math.max(t.measureText(p).width,t.measureText(y).width)+.5*o+10*x;(b>c||0>b)&&(x*=-1),t.textAlign=1===x?"left":"right",a&&(t.beginPath(),t.moveTo(v,g-5),t.lineTo(v,g-10),t.moveTo(v,g-10),t.lineTo(v+5*x,g-10),t.stroke(),t.closePath(),t.fillText(p,v+10*x,g-10)),l&&(t.beginPath(),t.moveTo(v,m+5),t.lineTo(v,m+10),t.moveTo(v,m+10),t.lineTo(v+5*x,m+10),t.stroke(),t.closePath(),t.fillText(y,v+10*x,m+10))},nt={candle:function(t,e,o,n,i){var r=e.incrementItemColor,l=e.decrementItemColor,a=e.incrementItemFill,c=e.decrementItemFill,f=n.open,u=n.close,d=n.high,h=n.low,g=i(Math.max(f,u)),m=i(Math.min(f,u))-g,v=i(d),p=i(h);if(t.strokeStyle=u>f?r:l,t.fillStyle=u>f?r:l,6>=o){t.beginPath(),t.moveTo(s(.5*o),s(v)),t.lineTo(s(.5*o),s(p)),t.closePath(),t.stroke();var y=s(u>f?g+m:g);t.beginPath(),t.moveTo(s(.5*o),y),t.lineTo(1,y),t.closePath(),t.stroke();var x=s(u>f?g:g+m);return t.beginPath(),t.moveTo(s(.5*o),x),t.lineTo(o-1,x),t.closePath(),void t.stroke()}t.beginPath(),t.moveTo(s(.5*o),s(v)),t.lineTo(s(.5*o),s(g)),t.closePath(),t.stroke(),t.beginPath(),t.moveTo(s(.5*o),s(g+m)),t.lineTo(s(.5*o),s(p)),t.closePath(),t.stroke(),(u>f&&a!==!1||f>=u&&c!==!1)&&t.fillRect(2,s(g),s(o-4),s(m)),t.strokeRect(2,s(g),s(o-4),s(m))},line:function(t,e,o,n,i){var r=e.itemColor,l=i(n);t.fillStyle=r,t.strokeStyle=r,t.lineTo(s(.5*o),l)},stick:function(t,e,o,n,i,r,l){var a=e.baseLine,c=e.linear,f=I,u=i(n),d=1;"number"==typeof a&&(f=a),t.strokeStyle=r,t.fillStyle=r,s(o)<=3||c===!0?(t.beginPath(),t.moveTo(s(.5*o),s(u)),t.lineTo(s(.5*o),s(i(f))),t.closePath(),t.stroke()):(l!==!1&&t.fillRect(s(d),s(u),s(o-2*d),s(i(f)-u)),t.strokeRect(s(d),s(u),s(o-2*d),s(i(f)-u)))}},it=function(t){var e=t.data,o=t.type,n=t.context,l=t.style,a=t.show,c=t.minInViewport,f=t.maxInViewport,u=g.clientWidth,d=g.clientHeight;if(0!==w.length){(isNaN(T[0])===!0||isNaN(T[1])===!0||void 0===T[0]||void 0===T[1])&&z(0,w.length);var h=nt[o],m=K(),v=m.tWidth,p=m.tHeight,y=v/(T[1]-T[0]);if(n.save(),n.clearRect(-10,-10,u+10,d+10),a!==!1){n.translate(A.left,0);var x=et[o](p);if(n.beginPath(),"line"===t.type&&l.horizon===!0){var b=x(e[0]);n.strokeStyle=l.itemColor,n.moveTo(y/2,b),n.lineTo(v-y/2,b),n.stroke(),n.closePath()}else{var C=T[0],S=T[1];for(s((T[1]-T[0])/5);S>C;C++){if(null!==e[C]&&void 0!==e[C]){var k="function"==typeof l.itemColor?l.itemColor(C):l.itemColor,L="function"==typeof l.itemFill?l.itemFill(C):l.itemFill;h(n,l,y,e[C],x,k,L)}n.translate(y,0)}if(n.stroke(),n.closePath(),l.renderMinMaxInViewport===!0)for(var M=0,P=0,I=T[1]-1;I>=T[0]&&(n.translate(-y,0),!(M>0&&P>0));I--)if(null!==e[I]&&void 0!==e[I]){var Y=r[o](e[I])===f,H=i[o](e[I])===c;if(Y===!0&&M++>0)continue;if(H===!0&&P++>0)continue;if(H);else if(!Y)continue;ot(n,o,y,x,H,Y,v,I,e[I])}}n.restore()}}},rt=function(){Q();for(var t in S){var e=S[t];it(e)}Z(),tt(),Ct(),at()},lt=function(t){St(t)},at=function(){var t=S[H];if(H&&t.style.renderLastIndex!==!1){var e=T[1]-1,o=void 0;"candle"===t.type?o=t.data[e].close:"stick"===t.type?o=t.data[e]:"line"===t.type&&(o=t.data[e]),void 0!==o&&mt({ctx:W,index:e,realPrice:o,focusYLabelColor:M.lastIndexYLabelColor,focusYAxisColor:"rgba(0,0,0,0)",focusYBackgroundColor:l(t,e),onlyRender:!0},!1,!0,!1)}},st=function(){H=void 0},ct=function(t){S[t]&&(H=t,Ct(),at())};g.addEventListener("mousewheel",function(t){t.preventDefault();var e=Math.round((T[1]-T[0])/8),o=t.deltaY/100*-e,n=[T[0]+o,T[1]];n[0]<0&&(n[0]=0,n[1]-=o),n[1]>w.length&&(n[1]=w.length),n[0]>=n[1]&&(n[0]=n[1]-1),z(n[0],n[1]),mt({x:t.layerX,y:t.layerY})});var ft=!1,ut=null;g.addEventListener("mousedown",function(t){ft=!0,ut=t.clientX}),window.addEventListener("mouseup",function(){ft===!0&&(ft=!1,ut=null)}),window.addEventListener("mousemove",function(t){var e=ut-t.clientX;if(ft===!0){t.preventDefault();var o=dt();if(null!==ut){var n=Math.abs(Math.floor((ut-A.left)/o)-Math.floor((t.clientX-A.left)/o)),i=0>e?-1:1,r=i*n,l=[T[0]+r,T[1]+r];if(l[0]<0||l[1]>w.length)return;z(l[0],l[1]),ut=t.clientX}}}),g.addEventListener("mousemove",function(t){mt({x:t.layerX,y:t.layerY})}),g.addEventListener("mouseout",function(t){pt()});var dt=function(){return K().tWidth/(T[1]-T[0])},ht=void 0,gt=function(t){var e=t.ctx,o=void 0===e?B:e,n=t.x,i=t.y,r=t.index,l=t.realPrice,s=t.focusXBackgroundColor,u=void 0===s?M.focusXBackgroundColor:s,d=t.focusXLabelColor,h=void 0===d?M.focusXLabelColor:d,m=t.focusXAxisColor,v=void 0===m?M.focusXAxisColor:m,p=t.focusYAxisColor,y=void 0===p?M.focusYAxisColor:p,x=t.focusYBackgroundColor,b=void 0===x?M.focusYBackgroundColor:x,C=t.focusYLabelColor,S=void 0===C?M.focusYLabelColor:C,k=t.onlyRender,H=void 0===k?!1:k,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:!0,F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:!1,W=arguments.length>3&&void 0!==arguments[3]?arguments[3]:!0,R=K(),V=R.tWidth,$=R.tHeight;void 0===l?l=a(i,A.top+$-L.bottom,A.top+L.top,I,Y):i=a(l,I,Y,A.top+$-L.bottom,A.top+L.top);var E=V/(T[1]-T[0]),z=void 0;if(void 0===r?(z=Math.floor((n-A.left)/E),r=T[0]+z):r-=T[0],ht!==r){if(0>r||r>=T[1])return void o.clearRect(-10,-10,g.clientWidth+10,g.clientHeight+10);if(o.save(),W===!0&&o.clearRect(-10,-10,g.clientWidth+10,g.clientHeight+10),o.translate(A.left,0),o.font="12px "+M.fontFamily,X===!0){if(o.textAlign=M.xLabelAlign,o.textBaseline="middle",o.strokeStyle=B.fillStyle=v,M.focusXAxisExtend===!0)o.fillRect(z*E,A.top,E,$);else{var N=z*E+E/2;o.beginPath(),o.moveTo(N,0),o.lineTo(N,A.top+$),o.closePath(),o.stroke()}if(M.xLabelShow!==!1){var _=f(w[r],P),j=B.measureText(_).width,O=5;E>j+2*O&&(O=(E-j)/2,j=E-2*O);var U=z*E,G=void 0,J=void 0;"top"===M.xLabelAlign?(G=0,J=A.top):(G=$,J=A.bottom),"right"===M.yLabelAlign||(U-=j+2*O-E),o.fillStyle=u,o.fillRect(U,G,j+2*O,J),o.fillStyle=h,o.fillText(_,U+O,G+J/2)}}if(F===!0&&A.top+$>=i&&A.top<=i){o.textBaseline="middle",o.strokeStyle=y,o.fillStyle=b,o.beginPath(),o.moveTo(0,i),o.lineTo(V,i),o.closePath(),o.stroke();var Q=void 0,Z=void 0,tt=20,et=void 0;"left"===M.yLabelAlign?(Q=-A.left,Z=A.left,et=-10,o.textAlign="right"):(Q=V,Z=A.right,et=V+10,o.textAlign="left"),o.fillRect(Q,i-tt/2,Z,tt),o.fillStyle=S,o.fillText(q(l),et,i)}if(o.restore(),H!==!0){D(function(t,e){return"object"===t.data[r]?c(null,t.data[r]):t.data[r]},function(t){return t}),new Date(w[r]);St(r)}}},mt=function(t){return Yt()!==!0?(h[u.$rootConnect].dispatchFocusIndex(t),void gt(t,!1,!0,!1)):(h[v].dispatchFocusIndex(t),void gt(t,!0,!0))},vt=function(){B.clearRect(-10,-10,g.clientWidth+10,g.clientHeight+10)},pt=function(){return Yt()!==!0?void h[u.$rootConnect].dispatchUnfocusIndex():(h[v].dispatchUnfocusIndex(),void vt())},yt={show:!1,forammters:{},titles:{},filters:[]},xt=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};c(t.formatters,yt.formatters),c(t.titles,yt.titles),yt=c(t,yt),Ct()},bt=null,Ct=function(){return null!==bt&&St(bt)},St=function(){var t=function(t){var e=t.ctx,o=t.texts,n=t.lineHeight,i=t.minWidth,r=void 0===i?M.tooltipMinWidth:i,l=t.notRender,a=void 0===l?!1:l,s=1,c=0,f=M.tooltipLetterSpace,u=!1,d=r;o.forEach(function(t){var o=void 0;o=Array.isArray(t.text)===!0?e.measureText(t.text.join("")).width+(t.text.length-1)*f:e.measureText(t.text).width,t.width=o,o>d&&(d=o)});for(var h=0;h<o.length;h++){var g=o[h];if(d<c+g.width&&(a!==!0&&e.translate(0,n),c=0,s++),a!==!0)if(e.fillStyle=g.color,Array.isArray(g.text)===!0)for(var m=0,v=0;v<g.text.length;v++)e.fillText(g.text[v],m+v*f,0),m+=e.measureText(g.text[v]).width;else e.fillText(g.text,c,0);c+=g.width+f,u=!0}return s=u===!1?0:s,{lineCount:s,height:s*n,width:d}};return function(e){var o=yt,i=o.show,r=o.filters,a=o.formatters,s=o.titles;if(R.clearRect(-10,-10,g.clientWidth+20,g.clientHeight+20),i===!0){var c=[],f=M.tooltipFontSize,u=1.2*f;R.font=f+"px "+M.fontFamily,R.textBaseline="top";for(var d in S){var h=S[d];if(-1===r.indexOf(d)&&h.show!==!1){var m=n[h.type]({title:s[d]||d,formatter:a&&a[d],data:h.data[e]});null!==m&&c.push({text:m,color:"string"==typeof h.style.itemColor?h.style.itemColor:M.tooltipTextColor})}}R.save();var v=function(e){return t({ctx:R,texts:c,lineHeight:u,notRender:e})},p=M.tooltipYPadding,y=M.tooltipXPadding,x=v(!0),b=x.height+p,C=x.width+y,T=K(),k=T.tWidth,w=T.tHeight;if(R.translate(A.left,A.top),"left"===M.tooltipXAlign?R.translate(M.tooltipXMargin,0):"right"===M.tooltipXAlign&&R.translate(k-C-M.tooltipCandleThick-M.tooltipXMargin,0),"top"===M.tooltipYAlign?R.translate(0,M.tooltipYMargin):"bottom"===M.tooltipYAlign&&R.translate(0,w-b-M.tooltipYMargin),H){var L=S[H],P=L.data;L.style;if(P[e]){var I=P[e];I.open,I.close;R.fillStyle=l(S[H],e),R.fillRect(0,0,M.tooltipCandleThick,b),R.translate(M.tooltipCandleThick,0)}}H||"right"!==M.tooltipXAlign||R.translate(M.tooltipCandleThick,0),R.fillStyle=M.tooltipBackgroundColor,R.fillRect(0,0,C,b),R.translate(y/2,1.2),v(),R.restore(),bt=e}}}(),Tt=function(){for(var t in e.layerStyle)x[t]=c(y.layerStyle[t],e.layerStyle[t])},kt=function(){g.style.backgroundColor=M.backgroundColor},wt=function(t){y=o[t],M=c(y.globalStyle,M),kt(),Tt();for(var e in S){var n=S[e];$(e,{style:x[n.type]})}J(),Z(),tt()},At=function(){b.map(function(t){t.width=g.clientWidth,t.height=g.clientHeight}),rt()},Lt=[],Mt=function(t){if(t instanceof m==!0){if(null!==u.$rootConnect)return void h[u.$rootConnect].connect(t);h[t.$key].getTimeline=function(){return k},h[t.$key].refreshTimeline(),Lt.push(t.$key),t.$rootConnect=v,rt(),t.render()}},Pt=function(){Yt()===!0?(Lt.map(function(t){return h[t].disconnect()}),Lt.splice(0,Lt.length)):h[v].disconnect(),rt()},It=function(t,e){return function(){for(var o=arguments.length,n=Array(o),i=0;o>i;i++)n[i]=arguments[i];if(u.$connect.length>0){t.apply(u,n);for(var r in Lt)h[Lt[r]][e].apply(u,n)}}};p.getTimeline=function(){return k},p.refreshTimeline=function(){return w=h[v].getTimeline()},p.setViewport=E,p.dispatchSetViewport=It(E,"setViewport"),p.focusIndex=gt,p.dispatchFocusIndex=It(gt,"focusIndex"),p.unfocusIndex=vt,p.dispatchUnfocusIndex=It(vt,"unfocusIndex"),p.setTimeline=function(){w.length<T[1]&&(T[1]=w.length),rt()},p.dispatchSetTimeline=function(){if(u.$connect.length>0)for(var t in Lt){var e=Lt[t];h[e].getTimeline=function(){return k},h[e].refreshTimeline()}},p.connect=function(){return Mt},p.disconnect=function(){p.getTimeline=function(){return k},p.refreshTimeline(),u.$rootConnect=null,rt()},p.minSpan=function(){return M.minSpan},this.$key=v,this.$connect=Lt,this.$rootConnect=null;var Yt=function(){return null===u.$rootConnect},Ht=function(t){return function(){for(var e=arguments.length,o=Array(e),n=0;e>n;n++)o[n]=arguments[n];return t.apply(u,o),u}};this.addLayer=Ht(V),this.setLayer=Ht($),this.setViewport=Ht(z),this.getViewport=Ht(N),this.setTimeline=Ht(_),this.setPadding=Ht(O),this.setStyle=Ht(U),this.setTheme=Ht(wt),this.resize=Ht(At),this.setDateFormatter=Ht(j),this.setTooltip=Ht(xt),this.connect=Ht(Mt),this.disconnect=Ht(Pt),this.setYLabelFormatter=Ht(G),this.setMainLayer=Ht(ct),this.unsetMainLayer=Ht(st),this.getViewport=Ht(N),this.render=Ht(rt),this.renderTooltip=Ht(lt),this.showLayers=function(t){for(var e=0;e<t.length;e++){var o=S[t[e]];o&&(o.show=!0),rt()}return u},this.hideLayers=function(t){for(var e=0;e<t.length;e++){var o=S[t[e]];o&&(o.show=!1),rt()}return u},J(),wt("white")}};return g.themes=o,g.getTheme=function(t){return o[t]},g.addTheme=function(t,e){return o[t]=e},g.calculateMA=function(t,e){for(var o=[],n=[],i=0,r=0,l=e.length;l>r;r++)o[r]=null,n.push(e[r]),i+=e[r],n.length===t&&(o[r]=i/t,i-=n.shift());return o},g.toValue=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;arguments.length>2&&void 0!==arguments[2]?arguments[2]:!0;if(isNaN(t)===!0)return"N/A";t=cutDemicalPoint(t,e);var o=t.toString().split("."),n=o[0].replace(/\B(?=(\d{3})+(?!\d))/g,",");if(void 0===o[1])return n;if(o[1].length<e)for(var i=0;i<e-o[1].length;i++)o[1]+="0";return n+"."+o[1]},g}();