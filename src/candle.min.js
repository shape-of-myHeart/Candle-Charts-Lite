'use strict';var _typeof='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(g){return typeof g}:function(g){return g&&'function'==typeof Symbol&&g.constructor===Symbol&&g!==Symbol.prototype?'symbol':typeof g};function _classCallCheck(g,k){if(!(g instanceof k))throw new TypeError('Cannot call a class as a function')}var Chart=function(){var init={globalStyle:{backgroundColor:'rgb(245, 250, 254)',fontFamily:'\uB9D1\uC740\uACE0\uB515',labelColor:'#5d5d5d',yLabelShow:!0,yLabelAlign:'right',yLabelWidth:100,yAxisShow:!0,yAxisColor:'#999',xLabelShow:!0,xLabelAlign:'bottom',xLabelHeight:30,xAxisShow:!0,xAxisColor:'#999',xSplitAxisColor:'rgb(210, 215, 219)',xSplitAxisDotted:!1,ySplitAxisColor:'rgb(210, 215, 219)',ySplitAxisDotted:[1,2],tooltipTextColor:'#333',tooltipBackgroundColor:'transparent',tooltipXAlign:'left',tooltipYAlign:'top',tooltipMinWidth:100,tooltipFontSize:14,tooltipXMargin:5,tooltipYMargin:5,tooltipXPadding:20,tooltipYPadding:5,tooltipCandleThick:5,tooltipLetterSpace:10,focusXAxisColor:'rgba(105, 100, 104, 0.1)',focusXBackgroundColor:'#555',focusXLabelColor:'#fff',focusXAxisExtend:!0,focusYAxisColor:'#888',focusYBackgroundColor:'#555',focusYLabelColor:'#fff',minSpan:8},layerType:'candle',layerStyle:{candle:{incrementItemColor:'rgb(252,4,4)',decrementItemColor:'rgb(0,168,0)'},line:{itemColor:'#000000'},stick:{itemColor:'#000000'}},grid:{top:0,right:0,bottom:0,left:0},padding:{top:30,right:0,bottom:30,left:0},dateFormatter:'MM-dd HH:mm'},themes={white:{globalStyle:{},layerStyle:{candle:{},line:{}}},dark:{globalStyle:{backgroundColor:'#151515',labelColor:'#aaa',xSplitAxisColor:'#333',ySplitAxisColor:'#333',tooltipTextColor:'#fff',focusXAxisColor:'rgba(0, 175, 255, 0.2)',focusXBackgroundColor:'rgb(10,98,138)',focusYBackgroundColor:'#333',tooltipBackgroundColor:'rgba(0,0,0,0.5)'},layerStyle:{candle:{incrementItemColor:'#14b143',decrementItemColor:'#ef232a'},line:{itemColor:'#999'},stick:{itemColor:'#999'}}}},renderForTypes={candle:function candle(_ref,_ref2){var g=_ref.ctx,k=_ref.itemWidth,m=_ref.transform,o=_ref.decrementItemColor,p=_ref.incrementItemColor,q=_ref2.open,u=_ref2.close,z=_ref2.high,A=_ref2.low,B=m(Math.max(q,u)),C=m(Math.min(q,u))-B,D=m(z),E=m(A);return g.strokeStyle=u>q?p:o,g.fillStyle=u>q?p:o,6>=k?(g.beginPath(),g.moveTo(f(0.5*k),f(D)),g.lineTo(f(0.5*k),f(E)),g.closePath(),void g.stroke()):void(g.beginPath(),g.moveTo(f(0.5*k),f(D)),g.lineTo(f(0.5*k),f(B)),g.closePath(),g.stroke(),g.beginPath(),g.moveTo(f(0.5*k),f(B+C)),g.lineTo(f(0.5*k),f(E)),g.closePath(),g.stroke(),g.fillRect(2,f(B),f(k-4),f(C)),g.strokeRect(2,f(B),f(k-4),f(C)))},line:function line(_ref3,p){var g=_ref3.ctx,k=_ref3.itemWidth,m=_ref3.transform,o=_ref3.itemColor;if(null!==p){var q=m(p);g.fillStyle=o,g.strokeStyle=o,g.lineTo(f(0.5*k),q)}},stick:function stick(_ref4,p){var g=_ref4.ctx,k=_ref4.itemWidth,m=_ref4.transform,o=_ref4.itemColor;if(null!==p){var q=m(p);g.fillStyle=o,g.fillRect(1,f(q),k-2,f(-q))}}},tooltipForTypes={candle:function candle(_ref5){var g=_ref5.title,k=_ref5.data,_ref5$formatter=_ref5.formatter,m=void 0===_ref5$formatter?function(o){return o}:_ref5$formatter;return null===k?null:[(g.open||'Open')+' '+m(k.open),(g.close||'Close')+' '+m(k.close),(g.low||'Low')+' '+m(k.low),(g.high||'High')+' '+m(k.high)]},line:function line(_ref6){var g=_ref6.title,k=_ref6.data,_ref6$formatter=_ref6.formatter,m=void 0===_ref6$formatter?function(o){return o}:_ref6$formatter;return null===k?null:g+' '+m(k)},stick:function stick(_ref7){var g=_ref7.title,k=_ref7.data,_ref7$formatter=_ref7.formatter,m=void 0===_ref7$formatter?function(o){return o}:_ref7$formatter;return null===k?null:g+' '+m(k)}},getMinForTypes={candle:function candle(g){return g.low},line:function line(g){return g},stick:function stick(g){return g}},getMaxForTypes={candle:function candle(g){return g.high},line:function line(g){return g},stick:function stick(g){return g}},map=function(g,k,m,o,p){return(g-k)/(m-k)*(p-o)+o},f=Math.floor,overwrite=function(g,k){for(var m in('object'!==('undefined'==typeof g?'undefined':_typeof(g))||null===g)&&(g={}),k)void 0===g[m]&&(g[m]=k[m]);return g},applyDateFormatter=function(g,k){return k.replace(/(yyyy|yy|MM|dd|hh|mm|ss)/gi,function(m){return'yyyy'===m?g.getFullYear():'yy'===m?zf(g.getFullYear()%1e3,2):'MM'===m?zf(g.getMonth()+1,2):'dd'===m?zf(g.getDate(),2):'HH'===m?zf(g.getHours(),2):'hh'===m?zf((h=g.getHours()%12)?h:12,2):'mm'===m?zf(g.getMinutes(),2):'ss'===m?zf(g.getSeconds(),2):m})},zf=function(g,k){if('number'==typeof g&&(g=g.toString()),'string'==typeof g){for(var o=0;o++<k-g.length;){}return m+g}},$keys=[],$methodByKey={},$setMethodByKey=function(g,k,m){$methodByKey[g]||($methodByKey[g]=[]),$methodByKey[g][k]=m,'$On'!==k&&$methodByKey[g].$On&&$methodByKey[g].$On(k)},$getMethodByKey=function(g,k){return $methodByKey[g][k]},Chart=function Chart(domId){var _this=this;_classCallCheck(this,Chart);var wrapper=document.getElementById(domId);if(null!==wrapper){for(var $key;-1!==$keys.indexOf($key=Math.random()+Math.random()+Math.random()););var theme,initLayerStyle={};wrapper.style.position='relative';var min,max,canvasStack=[],makeCanvas=function(){var g=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,k=document.createElement('canvas'),m=k.getContext('2d');return k.style.position='absolute',k.style.top=0,k.style.left=0,k.style.zIndex=g,k.width=wrapper.clientWidth,k.height=wrapper.clientHeight,wrapper.appendChild(k),m.translate(0.5,0.5),canvasStack.push(k),{canvas:k,context:m}},layers={},viewport=[],timeline=[],$timeline=[],grid=overwrite(null,init.grid),padding=overwrite(null,init.padding),globalStyle=overwrite(null,init.globalStyle),dateFormatter=init.dateFormatter,yLabelCtx=makeCanvas().context,xLabelCtx=makeCanvas().context,floatCtx=makeCanvas(1).context,tooltipCtx=makeCanvas(1e4).context,setLayer=function(g,_ref9){var k=_ref9.type,m=_ref9.data,o=_ref9.style,p=layers[g],q=void 0!==k&&k!==p.type?initLayerStyle[k]:p.style;p.type=k||p.type,p.data=m||p.data,p.style=overwrite(o,q),updateMinMax(),renderAll(),reloadTooltip()},layerMap=function(g,k){var m=[];for(var o in layers){var p=g(layers[o],o);k?m[k(o)]=p:m.push(p)}return m},_setViewport=function(g,k){if(!(0>g||0>k||viewport[0]===g&&viewport[1]===k)){var m=Math.max(g,k),o=Math.min(g,k);m-o<globalStyle.minSpan&&(o=m-globalStyle.minSpan),viewport[0]=o,viewport[1]=m,updateMinMax(),renderAll()}},setViewport=function(g,k){0>g||0>k||viewport[0]===g&&viewport[1]===k||(null===_this.$rootConnect?$methodByKey[$key].dispatchSetViewport(g,k):$methodByKey[_this.$rootConnect].dispatchSetViewport(g,k),_setViewport(g,k))},setGrid=function(){var g=!1===globalStyle.xLabelShow?0:1,k=!1===globalStyle.yLabelShow?0:1;grid.top='top'===globalStyle.xLabelAlign?globalStyle.xLabelHeight*g:0,grid.bottom='bottom'===globalStyle.xLabelAlign?globalStyle.xLabelHeight*g:0,grid.left='left'===globalStyle.yLabelAlign?globalStyle.yLabelWidth*k:0,grid.right='right'===globalStyle.yLabelAlign?globalStyle.yLabelWidth*k:0},getTransformSize=function(){return{tWidth:wrapper.clientWidth-grid.right-grid.left,tHeight:wrapper.clientHeight-grid.bottom-grid.top}},updateMinMax=function(){for(var g=layerMap(function(p){for(var q=p.data,u=p.type,z=getMinForTypes[u],A=getMaxForTypes[u],B=Infinity,C=-Infinity,D=viewport[0],E=viewport[1];D<E;D++)if(null!==q[D]){var F=z(q[D]),G=A(q[D]);B>F&&(B=F),C<G&&(C=G)}return{min:B,max:C}}),k=Infinity,m=-Infinity,o=0;o<g.length;o++)g[o].min<k&&(k=g[o].min),g[o].max>m&&(m=g[o].max);min=k,max=m},renderXLabel=function(){var _globalStyle=globalStyle,g=_globalStyle.xLabelHeight,k=_globalStyle.xLabelAlign,m=_globalStyle.xLabelShow,o=_globalStyle.xAxisShow,u=wrapper.clientWidth,z=wrapper.clientHeight,_getTransformSize=getTransformSize(),p=_getTransformSize.tWidth,q=_getTransformSize.tHeight,A=p/(viewport[1]-viewport[0]);xLabelCtx.save(),xLabelCtx.clearRect(-10,-10,u+10,z+10),xLabelCtx.translate(grid.left,0),xLabelCtx.textBaseline='middle',xLabelCtx.textAlign='left'===globalStyle.yLabelAlign?'right':'left',xLabelCtx.font='12px '+globalStyle.fontFamily;var B=q,C='top'===k?g/2:z-g/2,D='bottom'===k?B:grid.top;!1!==m&&(xLabelCtx.strokeStyle=globalStyle.xAxisColor,xLabelCtx.beginPath(),xLabelCtx.moveTo(0,D),xLabelCtx.lineTo(p,D),xLabelCtx.closePath(),xLabelCtx.stroke()),xLabelCtx.fillStyle=globalStyle.labelColor;for(var E=viewport[0],F=viewport[1],G=f((viewport[1]-viewport[0])/5);E<F;E++){if(-1==viewport[0]-F||0==(F-E)%G){var H=f(0.5*A);!1!==o&&(Array.isArray(globalStyle.xSplitAxisDotted)&&xLabelCtx.setLineDash(globalStyle.xSplitAxisDotted),xLabelCtx.strokeStyle=globalStyle.xSplitAxisColor,xLabelCtx.beginPath(),xLabelCtx.moveTo(H,grid.top),xLabelCtx.lineTo(H,B+grid.top),xLabelCtx.closePath(),xLabelCtx.stroke()),!1!==m&&(xLabelCtx.strokeStyle=globalStyle.xAxisColor,xLabelCtx.beginPath(),xLabelCtx.moveTo(H,D+('bottom'===k?5:-5)),xLabelCtx.lineTo(H,D),xLabelCtx.closePath(),xLabelCtx.stroke(),xLabelCtx.fillText(applyDateFormatter($timeline[E],dateFormatter),f(H),f(C)))}xLabelCtx.translate(A,0)}xLabelCtx.restore()},renderYLabel=function(){var _globalStyle2=globalStyle,g=_globalStyle2.yLabelWidth,k=_globalStyle2.yLabelAlign,m=_globalStyle2.yLabelShow,o=_globalStyle2.yAxisShow,u=wrapper.clientWidth,z=wrapper.clientHeight,_getTransformSize2=getTransformSize(),p=_getTransformSize2.tWidth,q=_getTransformSize2.tHeight;yLabelCtx.save(),yLabelCtx.clearRect(-10,-10,u+10,z+10),yLabelCtx.translate(0,q+grid.top),yLabelCtx.textBaseline='middle',yLabelCtx.textAlign='left'===k?'right':'left',yLabelCtx.font='12px '+globalStyle.fontFamily;var A=f('left'===k?g:u-g);yLabelCtx.strokeStyle=globalStyle.yAxisColor,yLabelCtx.fillStyle=globalStyle.labelColor,!1!==m&&(yLabelCtx.beginPath(),yLabelCtx.moveTo(A,0),yLabelCtx.lineTo(A,-q),yLabelCtx.closePath(),yLabelCtx.stroke());for(var C=(max-min)/2,D=1;C>10*D;)D*=10;C-=C%D,C=f(C);for(var G,E=f(min-min%C),F=0;F<=B+10&&(G=E+C*F,!(G>max));F++)if(!(G<min)){var H=-map(G,min,max,0,q);!1!==m&&(yLabelCtx.fillText(G.toString(),A+('right'===k?10:-10),H),yLabelCtx.strokeStyle=globalStyle.labelColor,yLabelCtx.beginPath(),yLabelCtx.moveTo(A,H),yLabelCtx.lineTo(A+('right'===k?5:-5),H),yLabelCtx.closePath(),yLabelCtx.stroke()),!1!==o&&(Array.isArray(globalStyle.ySplitAxisDotted)&&yLabelCtx.setLineDash(globalStyle.ySplitAxisDotted),yLabelCtx.strokeStyle=globalStyle.ySplitAxisColor,yLabelCtx.beginPath(),yLabelCtx.moveTo(grid.left,H),yLabelCtx.lineTo(p+grid.left-1,H),yLabelCtx.closePath(),yLabelCtx.stroke())}yLabelCtx.restore()},render=function(g){var k=g.data,m=g.type,o=g.context,p=g.canvas,q=g.style,A=wrapper.clientWidth,B=wrapper.clientHeight;if(0!==$timeline.length){(!0===isNaN(viewport[0])||!0===isNaN(viewport[1])||void 0===viewport[0]||void 0===viewport[1])&&setViewport(0,$timeline.length);var C=renderForTypes[m],_getTransformSize3=getTransformSize(),u=_getTransformSize3.tWidth,z=_getTransformSize3.tHeight,D=u/(viewport[1]-viewport[0]);o.save(),o.clearRect(-10,-10,A+10,B+10),o.translate(grid.left,z+grid.top),o.beginPath();for(var I,E=function(J){return-map(J,min,max,padding.bottom,z-padding.top)},F=viewport[0],G=viewport[1],H=f((viewport[1]-viewport[0])/5);F<G;F++)I='function'==typeof q.itemColor?q.itemColor(F):q.itemColor,C({ctx:o,itemWidth:D,transform:E,incrementItemColor:q.incrementItemColor,decrementItemColor:q.decrementItemColor,itemColor:I},k[F]),o.translate(D,0);o.stroke(),o.closePath(),o.restore()}},renderAll=function(){for(var g in layers){var k=layers[g];render(k)}renderXLabel(),renderYLabel(),reloadTooltip()};wrapper.addEventListener('mousewheel',function(g){g.preventDefault();var m=g.deltaY/100*-10,o=[viewport[0]+m,viewport[1]];0>o[0]&&(o[0]=0,o[1]-=m),o[1]>$timeline.length&&(o[1]=$timeline.length),o[0]>=o[1]&&(o[0]=o[1]-1),setViewport(o[0],o[1]),focusIndex({x:g.layerX,y:g.layerY})});var mousedown=!1,prevMouseX=null;wrapper.addEventListener('mousedown',function(g){mousedown=!0,prevMouseX=g.clientX}),window.addEventListener('mouseup',function(){!0==mousedown&&(mousedown=!1,prevMouseX=null)}),window.addEventListener('mousemove',function(g){var k=prevMouseX-g.clientX;if(!0==mousedown&&null!==prevMouseX&&10<=Math.abs(k)){g.preventDefault();var o=0>k?-1:1,p=o*5,q=[viewport[0]+p,viewport[1]+p];if(0>q[0]||q[1]>$timeline.length)return;setViewport(q[0],q[1]),prevMouseX=g.clientX}}),wrapper.addEventListener('mousemove',function(g){focusIndex({x:g.layerX,y:g.layerY})}),wrapper.addEventListener('mouseout',function(){unfocusIndex()});var previousFocusedIndex,_focusIndex=function(_ref10){var g=_ref10.x,k=_ref10.y,p=1<arguments.length&&void 0!==arguments[1]?arguments[1]:!0,q=2<arguments.length&&void 0!==arguments[2]&&arguments[2],u=3<arguments.length&&void 0!==arguments[3]?arguments[3]:!0,_getTransformSize4=getTransformSize(),m=_getTransformSize4.tWidth,o=_getTransformSize4.tHeight,z=map(k,grid.top,o+grid.top,min,max),A=m/(viewport[1]-viewport[0]),B=Math.floor((g-grid.left)/A),C=viewport[0]+B;if(previousFocusedIndex!==C){if(0>C||C>=viewport[1])return void floatCtx.clearRect(-10,-10,wrapper.clientWidth+10,wrapper.clientHeight+10);if(floatCtx.save(),!0===u&&floatCtx.clearRect(-10,-10,wrapper.clientWidth+10,wrapper.clientHeight+10),floatCtx.translate(grid.left,0),floatCtx.font='12px '+globalStyle.fontFamily,!0===p){if(floatCtx.textAlign=globalStyle.xLabelAlign,floatCtx.textBaseline='middle',floatCtx.strokeStyle=floatCtx.fillStyle=globalStyle.focusXAxisColor,!0===globalStyle.focusXAxisExtend)floatCtx.fillRect(B*A,grid.top,A,o);else{var D=B*A+A/2;floatCtx.beginPath(),floatCtx.moveTo(D,0),floatCtx.lineTo(D,grid.top+o),floatCtx.closePath(),floatCtx.stroke()}if(!1!==globalStyle.xLabelShow){var E=applyDateFormatter($timeline[C],dateFormatter),F=floatCtx.measureText(E).width,G=5;F+2*G<A&&(G=(A-F)/2,F=A-2*G);var I,J,H=B*A;'top'===globalStyle.xLabelAlign?(I=0,J=grid.top):(I=o,J=grid.bottom),'right'===globalStyle.yLabelAlign||(H-=F+2*G-A),floatCtx.fillStyle=globalStyle.focusXBackgroundColor,floatCtx.fillRect(H,I,F+2*G,J),floatCtx.fillStyle=globalStyle.focusXLabelColor,floatCtx.fillText(E,H+G,I+J/2)}}if(!0===q&&grid.top+o>=k&&grid.top<=k){floatCtx.textBaseline='middle',floatCtx.strokeStyle=globalStyle.focusYAxisColor,floatCtx.fillStyle=globalStyle.focusYBackgroundColor,floatCtx.beginPath(),floatCtx.moveTo(0,k),floatCtx.lineTo(m,k),floatCtx.closePath(),floatCtx.stroke();var K,L,N,M=20;'left'===globalStyle.yLabelAlign?(K=-grid.left,L=grid.left,N=-10,floatCtx.textAlign='right'):(K=m,L=grid.right,N=m+10,floatCtx.textAlign='left'),floatCtx.fillRect(K,k-M/2,L,M),floatCtx.fillStyle=globalStyle.focusYLabelColor,floatCtx.fillText(f(z),N,k)}floatCtx.restore();var O=layerMap(function(Q){return'object'===Q.data[C]?overwrite(null,Q.data[C]):Q.data[C]},function(Q){return Q}),P=new Date($timeline[C]);_this.onSelect(P,O),showTooltip(C)}},focusIndex=function(g){if(null===_this.$rootConnect)$methodByKey[$key].dispatchFocusIndex(g);else return $methodByKey[_this.$rootConnect].dispatchFocusIndex(g),void _focusIndex(g,!1,!0,!1);_focusIndex(g,!0,!0)},_unfocusIndex=function(){floatCtx.clearRect(-10,-10,wrapper.clientWidth+10,wrapper.clientHeight+10)},unfocusIndex=function(){if(null===_this.$rootConnect)$methodByKey[$key].dispatchUnfocusIndex();else return void $methodByKey[_this.$rootConnect].dispatchUnfocusIndex();_unfocusIndex()},tooltipOptions={show:!1,forammters:{},titles:{},filters:[],mainCandle:''},lastTooltipIndex=null,reloadTooltip=function(){return null!==lastTooltipIndex&&showTooltip(lastTooltipIndex)},showTooltip=function(){var g=function(_ref11){var k=_ref11.ctx,m=_ref11.texts,o=_ref11.lineHeight,_ref11$minWidth=_ref11.minWidth,p=void 0===_ref11$minWidth?globalStyle.tooltipMinWidth:_ref11$minWidth,_ref11$notRender=_ref11.notRender,q=void 0!==_ref11$notRender&&_ref11$notRender,u=1,z=0,A=globalStyle.tooltipLetterSpace,B=!1,C=-Infinity;m.forEach(function(H){var I;I=!0===Array.isArray(H.text)?k.measureText(H.text.join('')).width+(H.text.length-1)*A:k.measureText(H.text).width,H.width=I,I>C&&(C=I)});for(var E,D=0;D<m.length;D++){if(E=m[D],C<z+E.width&&(!0!==q&&k.translate(0,o),z=0,u++),!0!==q)if(k.fillStyle=E.color,!0===Array.isArray(E.text))for(var F=0,G=0;G<E.text.length;G++)k.fillText(E.text[G],F+G*A,0),F+=k.measureText(E.text[G]).width;else k.fillText(E.text,z,0);z+=E.width+A,B=!0}return u=!1==B?0:u,{lineCount:u,height:u*o,width:Math.max(C,p)}};return function(k){var _tooltipOptions=tooltipOptions,m=_tooltipOptions.show,o=_tooltipOptions.filters,p=_tooltipOptions.formatters,q=_tooltipOptions.titles,u=_tooltipOptions.mainCandle;if(tooltipCtx.clearRect(-10,-10,wrapper.clientWidth+20,wrapper.clientHeight+20),!0===m){var B=[],C=globalStyle.tooltipFontSize;for(var E in tooltipCtx.font=C+'px '+globalStyle.fontFamily,tooltipCtx.textBaseline='top',layers){if(-1!==o.indexOf(E))return;var F=layers[E],G=tooltipForTypes[F.type]({title:q[E]||E,formatter:p[E],data:F.data[k]});null===G||B.push({text:G,color:'string'==typeof F.style.itemColor?F.style.itemColor:globalStyle.tooltipTextColor})}tooltipCtx.save();var H=function(R){return g({ctx:tooltipCtx,texts:B,lineHeight:1.2*C,notRender:R})},I=globalStyle.tooltipYPadding,J=globalStyle.tooltipXPadding,K=H(!0),L=K.height+I,M=K.width+J,_getTransformSize5=getTransformSize(),z=_getTransformSize5.tWidth,A=_getTransformSize5.tHeight;if(tooltipCtx.translate(grid.left,grid.top),'left'===globalStyle.tooltipXAlign?tooltipCtx.translate(globalStyle.tooltipXMargin,0):'right'===globalStyle.tooltipXAlign&&tooltipCtx.translate(z-M-globalStyle.tooltipCandleThick-globalStyle.tooltipXMargin,0),'top'===globalStyle.tooltipYAlign?tooltipCtx.translate(0,globalStyle.tooltipYMargin):'bottom'===globalStyle.tooltipYAlign&&tooltipCtx.translate(0,A-L-globalStyle.tooltipYMargin),u){var _layers$mainCandle=layers[u],N=_layers$mainCandle.data,O=_layers$mainCandle.style,_data$index=N[k],P=_data$index.open,Q=_data$index.close;tooltipCtx.fillStyle=P<Q?O.incrementItemColor:O.decrementItemColor,tooltipCtx.fillRect(0,0,globalStyle.tooltipCandleThick,L),tooltipCtx.translate(globalStyle.tooltipCandleThick,0)}u||'right'!==globalStyle.tooltipXAlign||tooltipCtx.translate(globalStyle.tooltipCandleThick,0),tooltipCtx.fillStyle=globalStyle.tooltipBackgroundColor,tooltipCtx.fillRect(0,0,M,L),tooltipCtx.translate(J/2,1.2),H(),tooltipCtx.restore(),lastTooltipIndex=k}}}(),updateInitLayerStyle=function(){for(var g in init.layerStyle)initLayerStyle[g]=overwrite(theme.layerStyle[g],init.layerStyle[g])},updateWrapperStyle=function(){wrapper.style.backgroundColor=globalStyle.backgroundColor},$connect=[],connect=function(g){return!0==g instanceof Chart?null===_this.$rootConnect?void($setMethodByKey(g.$key,'getTimeline',$getMethodByKey($key,'getTimeline')),$connect.push(g.$key),g.$rootConnect=$key,renderAll(),g.render()):void $methodByKey[_this.$rootConnect].connect(g):void 0};$setMethodByKey($key,'getTimeline',function(){return timeline}),$setMethodByKey($key,'_setViewport',_setViewport),$setMethodByKey($key,'dispatchSetViewport',function(g,k){null===_this.$rootConnect&&(_setViewport(g,k),$connect.map(function(m){$methodByKey[m]._setViewport(g,k)}))}),$setMethodByKey($key,'_focusIndex',_focusIndex),$setMethodByKey($key,'dispatchFocusIndex',function(g,k){null===_this.$rootConnect&&(_focusIndex(g,k),$connect.map(function(m){$methodByKey[m]._focusIndex(g,k)}))}),$setMethodByKey($key,'_unfocusIndex',_unfocusIndex),$setMethodByKey($key,'dispatchUnfocusIndex',function(g,k){null===_this.$rootConnect&&(_unfocusIndex(g,k),$connect.map(function(m){$methodByKey[m]._unfocusIndex(g,k)}))}),$setMethodByKey($key,'connect',function(){return connect}),$setMethodByKey($key,'disconnect',function(){$setMethodByKey($key,'getTimeline',function(){return timeline}),_this.$rootConnect=null,renderAll()}),$setMethodByKey($key,'$On',function(g){'getTimeline'===g&&($timeline=$getMethodByKey($key,'getTimeline')())}),this.$key=$key,this.$connect=$connect,this.$rootConnect=null;for(var publicFunctions=['addLayer','setLayer','setViewport','getViewport','setTimeline','setPadding','setStyle','setTheme','resize','setDateFormatter','setTooltip','connect','disconnect'],i=0,l=publicFunctions.length;i<l;i++)eval('this.'+publicFunctions[i]+' = (...argv) => { '+publicFunctions[i]+'.apply(this, argv); return this; }');this.render=function(){return renderAll(),_this},this.onSelect=function(){},setGrid(),function setTheme(g){for(var k in theme=themes[g],globalStyle=overwrite(theme.globalStyle,globalStyle),updateWrapperStyle(),updateInitLayerStyle(),layers){var m=layers[k];setLayer(k,{style:initLayerStyle[m.type]})}setGrid(),renderXLabel(),renderYLabel()}('white')}};return Chart.getTheme=function(g){return themes[g]},Chart.addTheme=function(g,k){return themes[g]=k},Chart.calculateMA=function(g,k){for(var m=[],o=[],p=0,q=0,u=k.length;q<u;q++)m[q]=null,o.push(k[q]),p+=k[q],o.length===g&&(m[q]=p/g,p-=o.shift());return m},Chart.toPrice=function(g,k){if(isNaN(g))return'N/A';!0!==k&&(g=Math.floor(g));var m=g.toString().split('.'),o=m[0].replace(/\B(?=(\d{3})+(?!\d))/g,',');return void 0===m[1]?o:o+'.'+m[1]},Chart}();
