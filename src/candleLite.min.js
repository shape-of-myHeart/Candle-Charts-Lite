'use strict';var _createClass=function(){function g(j,k){for(var o,m=0;m<k.length;m++)o=k[m],o.enumerable=o.enumerable||!1,o.configurable=!0,'value'in o&&(o.writable=!0),Object.defineProperty(j,o.key,o)}return function(j,k,m){return k&&g(j.prototype,k),m&&g(j,m),j}}(),_typeof='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(g){return typeof g}:function(g){return g&&'function'==typeof Symbol&&g.constructor===Symbol&&g!==Symbol.prototype?'symbol':typeof g};function _classCallCheck(g,j){if(!(g instanceof j))throw new TypeError('Cannot call a class as a function')}var Chart=function(){var g={gray:{backgroundColor:'#f5f5f5',textColor:'#5d5d5d',axisColor:'#999',splitAxisColor:'rgba(0,0,0,0.05)',candle:{incrementItemColor:'#14b143',decrementItemColor:'#ef232a',minBodyWidth:7},line:{itemColor:'#000000'}},dark:{backgroundColor:'#151515',textColor:'#aaa',axisColor:'#999',splitAxisColor:'rgba(255,255,255,0.1)',candle:{incrementItemColor:'#14b143',decrementItemColor:'#ef232a',minBodyWidth:7},line:{itemColor:'#999'}}},j={candle:function candle(_ref,_ref2){var A=_ref.ctx,B=_ref.itemWidth,C=_ref.transform,D=_ref.style,E=_ref2.open,F=_ref2.close,G=_ref2.high,H=_ref2.low,I=C(Math.max(E,F)),J=C(Math.min(E,F))-I,K=C(G),L=C(H);return A.strokeStyle=F>E?D.incrementItemColor:D.decrementItemColor,A.fillStyle=F>E?D.incrementItemColor:D.decrementItemColor,B<=D.minBodyWidth?(A.beginPath(),A.moveTo(q(0.5*B),q(K)),A.lineTo(q(0.5*B),q(L)),A.closePath(),void A.stroke()):void(A.beginPath(),A.moveTo(q(0.5*B),q(K)),A.lineTo(q(0.5*B),q(I)),A.closePath(),A.stroke(),A.beginPath(),A.moveTo(q(0.5*B),q(I+J)),A.lineTo(q(0.5*B),q(L)),A.closePath(),A.stroke(),A.fillRect(2,q(I),q(B-4),q(J)),A.strokeRect(2,q(I),q(B-4),q(J)))},line:function line(_ref3,E){var A=_ref3.ctx,B=_ref3.itemWidth,C=_ref3.transform,D=_ref3.style;if(null!==E){var F=C(E);A.fillStyle=D.itemColor,A.strokeStyle=D.itemColor,A.lineTo(q(0.5*B),F)}}},k={candle:function candle(A,B){return'<div>Open: '+B.open+'</div><div>Close: '+B.close+'</div><div>Low: '+B.low+'</div><div>High: '+B.high+'</div><br/>'},line:function line(A,B,C){return'<div style=\'color:'+C+'\'>'+A+': '+B+'</div>'}},m={candle:function candle(A){return A.low},line:function line(A){return A}},o={candle:function candle(A){return A.high},line:function line(A){return A}},p=function(A,B,C,D,E){return(A-B)/(C-B)*(E-D)+D},q=Math.floor,r=function(A,B){('object'!==('undefined'==typeof A?'undefined':_typeof(A))||null===A)&&(A={});for(var F,C=Object.keys(B),D=0,E=C.length;D<E;D++)F=C[D],void 0===A[F]&&(A[F]=B[F]);return A},u=function(A,B){return B.replace(/(yyyy|yy|MM|dd|hh|mm|ss)/gi,function(C){return'yyyy'===C?A.getFullYear():'yy'===C?w(A.getFullYear()%1e3,2):'MM'===C?w(A.getMonth()+1,2):'dd'===C?w(A.getDate(),2):'HH'===C?w(A.getHours(),2):'hh'===C?w((h=A.getHours()%12)?h:12,2):'mm'===C?w(A.getMinutes(),2):'ss'===C?w(A.getSeconds(),2):C})},w=function(A,B){if('number'==typeof A&&(A=A.toString()),'string'==typeof A){for(var C='',D=0;D++<B-A.length;)C+='0';return C+A}},z=function(){function A(B){var ka=this;_classCallCheck(this,A);var G=document.getElementById(B);if(null===G)return void console.error('Stock.js :: dom id('+B+')\uC640 \uC77C\uCE58\uD558\uB294 \uAC1D\uCCB4\uB97C \uCC3E\uC9C0 \uBABB\uD558\uC600\uC2B5\uB2C8\uB2E4.');var H;G.style.position='relative';var I=document.createElement('div');I.classList.add('candle-lite-tooltip'),G.appendChild(I);var Q,R,V,J=[],K=function(){var oa=document.createElement('canvas'),pa=oa.getContext('2d');return oa.style.position='absolute',oa.style.top=0,oa.style.left=0,oa.width=G.clientWidth,oa.height=G.clientHeight,G.appendChild(oa),pa.translate(0.5,0.5),J.push(oa),{canvas:oa,context:pa}},L={type:'candle',grid:{top:0,right:100,bottom:30,left:0},padding:{top:50,right:0,bottom:50,left:0},style:{yLabelAlign:'right',yLabelWidth:100,xLabelAlign:'bottom',xLabelHeight:30,axisColor:'',splitAxisColor:'',textColor:''},dateFormatter:'MM-dd HH:mm'},M={},N=[],O=[],C=L.grid,D=L.padding,E=L.style,F=L.dateFormatter,P=E,S=K().context,T=K().context,U=K().context,Y=function(oa,pa){for(var ta,qa=Object.keys(M),ra=[],sa=0;sa<qa.length;sa++)ta=qa[sa],ra['function'==typeof pa?pa(ta):sa]=oa(M[ta],ta);return ra},Z=function(oa,pa){N[0]=Math.min(oa,pa),N[1]=Math.max(oa,pa),ea(),ga()},da=function(){return{tWidth:G.clientWidth-C.right-C.left,tHeight:G.clientHeight-C.bottom-C.top}},ea=function(){for(var oa=Y(function(sa){for(var ta=sa.data,ua=sa.type,va=m[ua],wa=o[ua],xa=Infinity,ya=-Infinity,za=N[0],Aa=N[1];za<Aa;za++)if(null!==ta[za]){var Ba=va(ta[za]),Ca=wa(ta[za]);xa>Ba&&(xa=Ba),ya<Ca&&(ya=Ca)}return{min:xa,max:ya}}),pa=Infinity,qa=-Infinity,ra=0;ra<oa.length;ra++)oa[ra].min<pa&&(pa=oa[ra].min),oa[ra].max>qa&&(qa=oa[ra].max);Q=pa,R=qa},fa=function(oa){var pa=P.xLabelHeight,qa=P.xLabelAlign,ra=P.yLabelWidth,sa=P.yLabelAlign,ta=oa.data,ua=oa.type,va=oa.context,wa=oa.canvas,xa=oa.style,Aa=G.clientWidth,Ba=G.clientHeight;(void 0===N[0]||void 0===N[1])&&Z(0,O.length);var Ca=j[ua],_getTransformSize=da(),ya=_getTransformSize.tWidth,za=_getTransformSize.tHeight,Da=ya/(N[1]-N[0]);va.save(),T.save(),S.save(),va.clearRect(-10,-10,Aa+10,Ba+10),T.clearRect(-10,-10,Aa+10,Ba+10),S.clearRect(-10,-10,Aa+10,Ba+10),va.translate(C.left,za+C.top),T.translate(C.left,0),S.translate(0,za+C.top),T.textBaseline='middle',T.textAlign='left',T.font='12px \'Apple SD Gothic Neo\',arial,sans-serif';var Ea=q('top'===qa?pa:Ba-pa),Fa='top'===qa?pa/2:Ba-pa/2;T.strokeStyle=P.axisColor,T.beginPath(),T.moveTo(0,Ea),T.lineTo(ya,Ea),T.closePath(),T.stroke(),va.beginPath();for(var Ga=N[0],Ha=N[1],Ia=q((N[1]-N[0])/5);Ga<Ha;Ga++){if(Ca({ctx:va,itemWidth:Da,transform:function transform(Ta){return-p(Ta,Q,R,D.top,za-D.bottom)},style:xa},ta[Ga]),-1==N[0]-Ha||0==(Ha-Ga)%Ia){var Ja=q(0.5*Da);T.strokeStyle=P.axisColor,T.beginPath(),T.moveTo(Ja,Ea),T.lineTo(Ja,Ea+5),T.closePath(),T.stroke(),T.strokeStyle=P.splitAxisColor,T.beginPath(),T.moveTo(Ja,0),T.lineTo(Ja,Ea),T.closePath(),T.stroke(),T.fillStyle=P.textColor,T.fillText(u(O[Ga],F),q(Ja),q(Fa))}va.translate(Da,0),T.translate(Da,0)}va.stroke(),va.closePath(),S.textBaseline='middle',S.textAlign='left'===sa?'right':'left',S.font='12px \'Apple SD Gothic Neo\',arial,sans-serif';var Ka=q('left'===sa?ra:Aa-ra);S.beginPath(),S.strokeStyle=P.axisColor,S.moveTo(Ka,0),S.lineTo(Ka,-za),S.closePath(),S.stroke();for(var Ma=(R-Q)/10,Na=10,Oa=1;Oa+Na<Ma;)Oa*=Na;var Pa=q(Q-Q%Oa);S.fillStyle=P.textColor;for(var Ra,Qa=0;Qa<La&&(Ra=Pa+Oa*Qa,!(Ra>R));Qa++)if(!(Ra<Q)){var Sa=-p(Ra,Q,R,0,za);S.fillText(Ra.toString(),Ka+5,Sa),S.strokeStyle=P.splitAxisColor,S.beginPath(),S.moveTo(C.left,Sa),S.lineTo(Ka-1,Sa),S.closePath(),S.stroke()}S.restore(),T.restore(),va.restore()},ga=function(){return Y(function(oa){return fa(oa)})};G.addEventListener('mousewheel',function(oa){var pa=-5*(oa.deltaY/100),qa=[N[0]+pa,N[1]];0>qa[0]&&(qa[0]=0,qa[1]-=pa),qa[1]>O.length&&(qa[1]=O.length),qa[0]>=qa[1]&&(qa[0]=qa[1]-1),Z(qa[0],qa[1]),ja({x:oa.layerX,y:oa.layerY})});var ha=!1,ia=null;G.addEventListener('mousedown',function(oa){ha=!0,ia=oa.clientX}),window.addEventListener('mouseup',function(){!0==ha&&(ha=!1,ia=null)}),window.addEventListener('mousemove',function(oa){var pa=ia-oa.clientX;if(!0==ha&&null!==ia&&10<=Math.abs(pa)){oa.preventDefault();var qa=0>pa?-1:1,ra=5*qa,sa=[N[0]+ra,N[1]+ra];if(0>sa[0]||sa[1]>O.length)return;Z(sa[0],sa[1]),ia=oa.clientX}}),G.addEventListener('mousemove',function(oa){ja({x:oa.layerX,y:oa.layerY})}),G.addEventListener('mouseout',function(){U.clearRect(-10,-10,G.clientWidth+10,G.clientHeight+10)});var ja=function(_ref6){var oa=_ref6.x,pa=_ref6.y,_getTransformSize2=da(),qa=_getTransformSize2.tWidth,ra=_getTransformSize2.tHeight,sa=qa/(N[1]-N[0]),ta=Math.floor(oa/sa),ua=N[0]+ta;if(0>ua||ua>=N[1])return void U.clearRect(-10,-10,G.clientWidth+10,G.clientHeight+10);U.save(),U.clearRect(-10,-10,G.clientWidth+10,G.clientHeight+10),U.fillStyle='rgba(0, 175, 255, 0.1)',U.strokeStyle='rgba(0, 175, 255, 0.2)',U.fillRect(ta*sa,C.top,sa,ra),U.strokeRect(ta*sa,C.top,sa,ra),U.restore();var va=Y(function(wa){return'object'===wa.data[ua]?r(null,wa.data[ua]):wa.data[ua]},function(wa){return wa});ka.onSelect(va,la(va))},la=function(oa){return function(pa,qa){void 0===qa&&(qa={});for(var ra=M[pa],sa=Object.keys(oa),ua=0,va=sa.length;ua<va;ua++){var wa=sa[ua],xa=M[wa];k[xa.type](qa[wa]||wa,oa[wa],xa.style.itemColor||'')}I.innerHTML='<div class=\'candle-lite-tooltip-colorpick\' style=\'background-color:'+(oa[pa].close>oa[pa].open?ra.style.incrementItemColor:ra.style.decrementItemColor)+'\'></div>'+ta}},ma=function(oa){H=g[oa],G.style.backgroundColor=H.backgroundColor,V={},V.candle=r(null,H.candle),V.line=r(null,H.line),Y(function(pa){return pa.style=r(V[pa.type],pa.style)}),E.axisColor=H.axisColor,E.splitAxisColor=H.splitAxisColor,E.textColor=H.textColor,ga()};ma('gray');this.addLayer=function W(oa,_ref4){var pa=_ref4.type,qa=_ref4.data,ra=_ref4.style;if(void 0!==M[oa])return void console.error('Stock.js :: \uC774\uBBF8 \uC874\uC7AC\uD558\uB294 \uB808\uC774\uC5B4\uC774\uB984 \uC785\uB2C8\uB2E4.');var sa=K();sa.type=pa||L.layer.type,sa.data=qa?qa:[],sa.style=r(ra,V[sa.type]),M[oa]=sa,ea()},this.setLayer=function X(oa,_ref5){var pa=_ref5.type,qa=_ref5.data,ra=_ref5.style,sa=M[oa],ta=sa.style;void 0!==pa&&pa!==sa.type&&(sa.style={},ta=V[pa]),sa.type=pa||sa.type,sa.data=qa?qa:sa.data,sa.style=r(ra,ta),ea(),fa(sa)},this.setViewport=Z,this.getViewport=function $(){return[N[0],N[1]]},this.setTimeline=function _(oa){O=[];for(var pa=0,qa=oa.length;pa<qa;pa++)O.push(new Date(oa[pa]))},this.setGrid=function aa(oa){C=r(oa,C),ga()},this.setPadding=function ba(){D=r(pGrid,D),ga()},this.render=function(){return ga()},this.setTheme=ma,this.resize=function na(){J.map(function(oa){oa.width=G.clientWidth,oa.height=G.clientHeight}),ga()},this.onSelect=function(){}}return _createClass(A,[{key:'addTheme',value:function addTheme(B,C){_addTheme(B,C)}}]),A}();return z.addTheme=function(A,B){return g[A]=B},z.calculateMA=function(A,B){for(var C=[],D=[],E=0,F=0,G=B.length;F<G;F++)C[F]=null,D.push(B[F]),E+=B[F],D.length===A&&(C[F]=E/A,E-=D.shift());return C},z}();