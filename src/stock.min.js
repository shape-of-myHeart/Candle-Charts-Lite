"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(g){return typeof g}:function(g){return g&&"function"==typeof Symbol&&g.constructor===Symbol&&g!==Symbol.prototype?"symbol":typeof g};function _classCallCheck(g,j){if(!(g instanceof j))throw new TypeError("Cannot call a class as a function")}var Chart=function(){var g=function(r,u){return u.replace(/(yyyy|yy|MM|dd|hh|mm|ss)/gi,function(w){return"yyyy"===w?r.getFullYear():"yy"===w?j(r.getFullYear()%1e3,2):"MM"===w?j(r.getMonth()+1,2):"dd"===w?j(r.getDate(),2):"HH"===w?j(r.getHours(),2):"hh"===w?j((h=r.getHours()%12)?h:12,2):"mm"===w?j(r.getMinutes(),2):"ss"===w?j(r.getSeconds(),2):w})},j=function(r,u){if("number"==typeof r&&(r=r.toString()),"string"==typeof r){for(var w="",z=0;z++<u-r.length;)w+="0";return w+r}},k={gray:{backgroundColor:"#f5f5f5",textColor:"#5d5d5d",axisColor:"#999",splitAxisColor:"rgba(0,0,0,0.05)",candle:{incrementItemColor:"#14b143",decrementItemColor:"#ef232a"},line:{itemColor:"#000000"}},dark:{backgroundColor:"#151515",textColor:"#aaa",axisColor:"#999",splitAxisColor:"rgba(255,255,255,0.1)",candle:{incrementItemColor:"#14b143",decrementItemColor:"#ef232a"},line:{itemColor:"#999"}}},m={candle:function candle(_ref,_ref2){var r=_ref.ctx,u=_ref.itemWidth,w=_ref.transform,z=_ref.style,A=_ref2.open,B=_ref2.close,C=_ref2.high,D=_ref2.low,E=w(Math.max(A,B)),F=w(Math.min(A,B))-E,G=w(C),H=w(D);r.strokeStyle=B>A?z.incrementItemColor:z.decrementItemColor,r.fillStyle=B>A?z.incrementItemColor:z.decrementItemColor,r.beginPath(),r.moveTo(q(0.5*u),q(G)),r.lineTo(q(0.5*u),q(E)),r.closePath(),r.stroke(),r.beginPath(),r.moveTo(q(0.5*u),q(E+F)),r.lineTo(q(0.5*u),q(H)),r.closePath(),r.stroke(),r.fillRect(q(0.1*u),q(E),q(0.8*u),q(F)),r.strokeRect(q(0.1*u),q(E),q(0.8*u),q(F))},line:function line(_ref3,A){var r=_ref3.ctx,u=_ref3.itemWidth,w=_ref3.transform,z=_ref3.style;if(null!==A){var B=w(A);r.fillStyle=z.itemColor,r.strokeStyle=z.itemColor,r.lineTo(q(0.5*u),B)}}},o=function(r,u){"object"!==("undefined"==typeof r?"undefined":_typeof(r))&&(r={});for(var B,w=Object.keys(u),z=0,A=w.length;z<A;z++)B=w[z],void 0===r[B]&&(r[B]=u[B]);return r},p=function(r,u,w,z,A){return(r-u)/(w-u)*(A-z)+z},q=Math.floor;return function r(u){var ha=this;_classCallCheck(this,r);var C=document.getElementById(u);if(null===C)return void console.error("Stock.js :: dom id("+u+")\uC640 \uC77C\uCE58\uD558\uB294 \uAC1D\uCCB4\uB97C \uCC3E\uC9C0 \uBABB\uD558\uC600\uC2B5\uB2C8\uB2E4.");var D;C.style.position="relative";var E=[],F=function(){var ka=document.createElement("canvas"),la=ka.getContext("2d");return ka.style.position="absolute",ka.style.top=0,ka.style.left=0,ka.width=C.clientWidth,ka.height=C.clientHeight,C.appendChild(ka),la.translate(0.5,0.5),E.push(ka),{canvas:ka,context:la}},G={type:"candle",grid:{top:0,right:100,bottom:30,left:0},padding:{top:50,right:0,bottom:50,left:0},style:{gap:0.2,yLabelAlign:"right",yLabelWidth:100,xLabelAlign:"bottom",xLabelHeight:30,axisColor:"",splitAxisColor:"",textColor:""},dateFormatter:"MM-dd HH:mm"},H={},I=[],J=[],w=G.grid,z=G.padding,A=G.style,B=G.dateFormatter,K=A,L,M,N=F().context,O=F().context,P=F().context,Q={candle:function candle(ka){return ka.low},line:function line(ka){return ka}},R={candle:function candle(ka){return ka.high},line:function line(ka){return ka}},S,V=function(ka,la){for(var pa,ma=Object.keys(H),na=[],oa=0;oa<ma.length;oa++)pa=ma[oa],na["function"==typeof la?la(pa):oa]=ka(H[pa],pa);return na},W=function(ka,la){I[0]=Math.min(ka,la),I[1]=Math.max(ka,la),ba(),da()},aa=function(){return{tWidth:C.clientWidth-w.right-w.left,tHeight:C.clientHeight-w.bottom-w.top}},ba=function(){for(var ka=V(function(oa){for(var pa=oa.data,qa=oa.type,ra=Q[qa],sa=R[qa],ta=Infinity,ua=-Infinity,va=I[0],wa=I[1];va<wa;va++)if(null!==pa[va]){var xa=ra(pa[va]),ya=sa(pa[va]);ta>xa&&(ta=xa),ua<ya&&(ua=ya)}return{min:ta,max:ua}}),la=Infinity,ma=-Infinity,na=0;na<ka.length;na++)ka[na].min<la&&(la=ka[na].min),ka[na].max>ma&&(ma=ka[na].max);L=la,M=ma},ca=function(ka){var la=K.xLabelHeight,ma=K.xLabelAlign,na=K.yLabelWidth,oa=K.yLabelAlign,pa=ka.data,qa=ka.type,ra=ka.context,sa=ka.canvas,ta=ka.style,wa=C.clientWidth,xa=C.clientHeight;(I[0]===void 0||I[1]===void 0)&&W(0,J.length);var ya=m[qa],_getTransformSize=aa(),ua=_getTransformSize.tWidth,va=_getTransformSize.tHeight,za=ua/(I[1]-I[0]);ra.save(),O.save(),N.save(),ra.clearRect(-10,-10,wa+10,xa+10),O.clearRect(-10,-10,wa+10,xa+10),N.clearRect(-10,-10,wa+10,xa+10),ra.translate(w.left,va+w.top),O.translate(w.left,0),N.translate(0,va+w.top),O.textBaseline="middle",O.textAlign="left",O.font="12px 'Apple SD Gothic Neo',arial,sans-serif";var Aa=q("top"===ma?la:xa-la),Ba="top"===ma?la/2:xa-la/2;O.strokeStyle=K.axisColor,O.beginPath(),O.moveTo(0,Aa),O.lineTo(ua,Aa),O.closePath(),O.stroke(),ra.beginPath();for(var Ca=I[0],Da=I[1],Ea=q((I[1]-I[0])/5);Ca<Da;Ca++){if(ya({ctx:ra,itemWidth:za,transform:function transform(Pa){return-p(Pa,L,M,z.top,va-z.bottom)},style:ta},pa[Ca]),-1==I[0]-Da||0==(Da-Ca)%Ea){var Fa=q(0.5*za);O.strokeStyle=K.axisColor,O.beginPath(),O.moveTo(Fa,Aa),O.lineTo(Fa,Aa+5),O.closePath(),O.stroke(),O.strokeStyle=K.splitAxisColor,O.beginPath(),O.moveTo(Fa,0),O.lineTo(Fa,Aa),O.closePath(),O.stroke(),O.fillStyle=K.textColor,O.fillText(g(J[Ca],B),q(Fa),q(Ba))}ra.translate(za,0),O.translate(za,0)}ra.stroke(),ra.closePath(),N.textBaseline="middle",N.textAlign="left"===oa?"right":"left",N.font="12px 'Apple SD Gothic Neo',arial,sans-serif";var Ga=q("left"===oa?na:wa-na);N.beginPath(),N.strokeStyle=K.axisColor,N.moveTo(Ga,0),N.lineTo(Ga,-va),N.closePath(),N.stroke();for(var Ia=(M-L)/10,Ja=10,Ka=1;Ka+Ja<Ia;)Ka*=Ja;var La=q(L-L%Ka);N.fillStyle=K.textColor;for(var Na,Ma=0;Ma<Ha&&(Na=La+Ka*Ma,!(Na>M));Ma++)if(!(Na<L)){var Oa=-p(Na,L,M,0,va);N.fillText(Na.toString(),Ga+5,Oa),N.strokeStyle=K.splitAxisColor,N.beginPath(),N.moveTo(w.left,Oa),N.lineTo(Ga-1,Oa),N.closePath(),N.stroke()}N.restore(),O.restore(),ra.restore()},da=function(){return V(function(ka){return ca(ka)})};C.addEventListener("mousewheel",function(ka){var la=-5*(ka.deltaY/100),ma=[I[0]+la,I[1]];0>ma[0]&&(ma[0]=0,ma[1]-=la),ma[1]>J.length&&(ma[1]=J.length),ma[0]>=ma[1]&&(ma[0]=ma[1]-1),W(ma[0],ma[1]),ga({x:ka.layerX,y:ka.layerY})});var ea=!1,fa=null;C.addEventListener("mousedown",function(ka){ea=!0,fa=ka.clientX}),window.addEventListener("mouseup",function(){!0==ea&&(ea=!1,fa=null)}),window.addEventListener("mousemove",function(ka){var la=fa-ka.clientX;if(!0==ea&&null!==fa&&10<=Math.abs(la)){ka.preventDefault();var ma=0>la?-1:1,na=5*ma,oa=[I[0]+na,I[1]+na];if(0>oa[0]||oa[1]>J.length)return;W(oa[0],oa[1]),fa=ka.clientX}}),C.addEventListener("mousemove",function(ka){ga({x:ka.layerX,y:ka.layerY})}),C.addEventListener("mouseout",function(){P.clearRect(-10,-10,C.clientWidth+10,C.clientHeight+10)});var ga=function(_ref6){var ka=_ref6.x,la=_ref6.y,_getTransformSize2=aa(),ma=_getTransformSize2.tWidth,na=_getTransformSize2.tHeight,oa=ma/(I[1]-I[0]),pa=Math.floor((ka-w.left)/oa);return 0>pa||I[0]+pa>=I[1]?void P.clearRect(-10,-10,C.clientWidth+10,C.clientHeight+10):void(P.save(),P.clearRect(-10,-10,C.clientWidth+10,C.clientHeight+10),P.translate(w.left,0),P.fillStyle="rgba(0, 175, 255, 0.1)",P.strokeStyle="rgba(0, 175, 255, 0.2)",P.fillRect(pa*oa,w.top,oa,na),P.strokeRect(pa*oa,w.top,oa,na),P.restore(),ha.onSelect(V(function(qa){return"object"===qa.data[pa]?o(null,qa.data[pa]):qa.data[pa]},function(qa){return qa})))},ia=function(ka){D=k[ka],C.style.backgroundColor=D.backgroundColor,S={candle:{incrementItemColor:D.candle.incrementItemColor,decrementItemColor:D.candle.decrementItemColor},line:{itemColor:D.line.itemColor}},V(function(la){return la.style=o(S[la.type],la.style)}),A.axisColor=D.axisColor,A.splitAxisColor=D.splitAxisColor,A.textColor=D.textColor,da()};ia("gray");this.addLayer=function T(ka,_ref4){var la=_ref4.type,ma=_ref4.data,na=_ref4.style;if(void 0!==H[ka])return void console.error("Stock.js :: \uC774\uBBF8 \uC874\uC7AC\uD558\uB294 \uB808\uC774\uC5B4\uC774\uB984 \uC785\uB2C8\uB2E4.");var oa=F();oa.type=la||G.layer.type,oa.data=ma?ma:[],oa.style=o(na,S[oa.type]),H[ka]=oa,ba()},this.setLayer=function U(ka,_ref5){var la=_ref5.type,ma=_ref5.data,na=_ref5.style,oa=H[ka],pa=oa.style;la!==void 0&&la!==oa.type&&(oa.style={},pa=S[la]),oa.type=la||oa.type,oa.data=ma?ma:oa.data,oa.style=o(na,pa),ba(),ca(oa)},this.setViewport=W,this.getViewport=function X(){return[I[0],I[1]]},this.setTimeline=function Y(ka){J=[];for(var la=0,ma=ka.length;la<ma;la++)J.push(new Date(ka[la]))},this.setGrid=function Z(ka){w=o(ka,w),da()},this.setPadding=function $(){z=o(pGrid,z),da()},this.render=function(){return da()},this.setTheme=ia,this.resize=function ja(){E.map(function(ka){ka.width=C.clientWidth,ka.height=C.clientHeight}),da()},this.onSelect=function(){}}}();Chart.calculateMA=function(g,j){for(var k=[],m=[],o=0,p=0,q=j.length;p<q;p++)k[p]=null,m.push(j[p]),o+=j[p],m.length===g&&(k[p]=o/g,o-=m.shift());return k};
